{% if single_device %}
<script>
var single_device = true;
</script>
{% endif %}

<fieldset class="module aligned">

    {% if fieldset.name %}<h2>{{ fieldset.name }}</h2>{% endif %}
    {% if fieldset.description %}
        <div class="description">{{ fieldset.description|safe }}</div>
    {% endif %}
    {% for line in fieldset %}

    <div>
        {% for field in line %}
            {% if field.field.name in custom_filter_fields %}
                {% if field.field.name == 'device' %}
                    {% if object.device.all or object.device %}
                        <table>
                            <tr>
                                <td>Id</td>
                                <td>Nazwa</td>
                                <td>Producent</td>
                                <td>Model</td>
                                <td>Nr seryjny</td>
                                <td>Nr inwentarzowy</td>
                                <td>Lokalizacja</td>
                            </tr>
                            {% if object.device and single_device %}
                                    <tr>
                                        <td id="{{ object.device.pk }}">{{ object.device.pk }}.</td>
                                        <td>
                                            {{ object.device }}
                                        </td>
                                        <td>{{ object.device.make }}</td>
                                        <td>{{ object.device.model }}</td>
                                        <td>{{ object.device.serial_number }}</td>
                                        <td>{{ object.device.inventory_number }}</td>
                                        <td>{{ object.device.location }}</td>
                                    </tr>
                                {% endif %}

                                {% for current_related_object in object.device.all %}
                                    <tr class="current_related_objects_{{ field.field.name }}">
                                        <td id="{{ current_related_object.pk }}">{{ current_related_object.pk }}.</td>
                                        <td>
                                            {{ current_related_object }}
                                        </td>
                                        <td>{{ current_related_object.make }}</td>
                                        <td>{{ current_related_object.model }}</td>
                                        <td>{{ current_related_object.serial_number }}</td>
                                        <td>{{ current_related_object.inventory_number }}</td>
                                        <td>{{ current_related_object.location }}</td>
                                    </tr>
                                {% endfor %}
                                </table>
                            {% else %}
                                <table>
                                <tr><td><p>Brak powiązanych urządzeń</p></td></tr>
                                </table>
                            {% endif %}
                        {% endif %}
                        {% if field.field.name == 'service' %}
                            {% if object.service.all %}
                                <table>
                                <tr>
                                    <td>Id</td>
                                    <td>Nazwa</td>
                                    <td>Data dodania</td>
                                    <td>Osoba zlecająca</td>
                                    <td>Kontrahent</td>
                                    <td>Status</td>
                                </tr>
                                {% for current_related_object in object.service.all %}
                                    <tr class="current_related_objects_{{ field.field.name }}">
                                        <td id="{{ current_related_object.pk }}">{{ current_related_object.pk }}.</td>
                                        <td>{{ current_related_object }}</td>
                                        <td>{{ current_related_object.timestamp }}</td>
                                        <td>{{ current_related_object.person_creating }}</td>
                                        <td>{{ current_related_object.contractor }}</td>
                                        <td>{{ current_related_object.get_status_display }}</td>
                                    </tr>
                                {% endfor %}
                                </table>
                            {% else %}
                                <table>
                                <tr><td><p>Brak powiązanych zleceń</p></td></tr>
                                </table>
                            {% endif %}
                        {% endif %}
                        {% if field.field.name == 'external_service' %}
                            {% if object.get_services %}
                                <table>
                                <tr>
                                    <td>Id</td>
                                    <td>Nazwa</td>
                                    <td>Data dodania</td>
                                    <td>Osoba zlecająca</td>
                                    <td>Kontrahent</td>
                                    <td>Status</td>
                                </tr>
                                {% for current_related_object in object.get_services %}
                                    <tr class="current_related_objects_{{ field.field.name }}">
                                        <td id="{{ current_related_object.pk }}">{{ current_related_object.pk }}.</td>
                                        <td>{{ current_related_object }}</td>
                                        <td>{{ current_related_object.timestamp }}</td>
                                        <td>{{ current_related_object.person_creating }}</td>
                                        <td>{{ current_related_object.contractor }}</td>
                                        <td>{{ current_related_object.get_status_display }}</td>
                                    </tr>
                                {% endfor %}
                                </table>
                            {% else %}
                                <table>
                                <tr><td><p>Brak powiązanych zleceń</p></td></tr>
                                </table>
                            {% endif %}
                        {% endif %}
                        {% if field.field.name == 'ticket' %}
                            {% if object.ticket.all %}
                                <table>
                                <tr>
                                    <td>Id</td>
                                    <td>Nazwa</td>
                                    <td>Data dodania</td>
                                    <td>Data zamknięcia</td>
                                </tr>
                                {% for current_related_object in object.ticket.all %}
                                    <tr class="current_related_objects_{{ field.field.name }}">
                                        <td id="{{ current_related_object.pk }}">{{ current_related_object.pk }}.</td>
                                        <td>{{ current_related_object }}</td>
                                        <td>{{ current_related_object.timestamp }}</td>
                                        <td>{{ current_related_object.date_closing }}</td>
                                    </tr>
                                {% endfor %}
                                </table>
                            {% else %}
                                <table>
                                <tr><td><p>Brak powiązanych zgłoszeń</p></td></tr>
                                </table>

                            {% endif %}
                        {% endif %}
                {% else %}
                    <div>
                        <table>
                            <tr>
                                <td width="25%"><p>{{ field.label_tag }}</p></td>
                                <td>
                                {% if field.contents %}{{ field.contents|linebreaksbr }}{% else %}------{% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>

                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
</fieldset>
